## Скрипт развертывания БД 1С в зависимости от принадлежности авторизованного пользователя к соответствующей группе пользователей Active Directory средствами групповых политик

#### Порядок развертывания групповой политики

- Создать сетевой каталог, в котором разместить файлы конфигурации БД 1С (.v8i). Каждый файл должен соответствовать одной БД. Возможно скрыть данный каталог в сетевом окружении. У пользователей должны быть права на чтение данных в указанном каталоге
- Скопировать скрипт 1C_DB_GPO.ps1 в сетевой каталог (например: \\\contoso.com\sysvol\contoso.com\scripts)
- Указать актуальные данные в ini-файле конфигурации (также должен быть доступен в пределах локальной сети)
- Создать группы пользователей в Active Directory для развертывания БД 1С. Каждая группа должна соответстовать одной БД
- Создать файл csv (пример файла присутствует в каталоге Example - [1C_DB_GPO.csv](Example/1C_DB_GPO_example.csv)) в кодировке Windows-1251 с разделителем "," (используется в Microsoft Excel по-умолчанию, возможно изменить), содержащий 2 столбца (возможно изменить заголовки столбцов):
    - Группа пользователей - название группы пользователей Active Directory
    - Файл конфигурации БД - полный путь к файлу конфигурации БД 1С

- Создать групповую политику, добавить Logon-скрипт - 1C_DB_GPO.ps1 (пример отчета группвой политики присутствует в каталоге Example - [GPO_Report_example.htm](Example/GPO_Report_example.htm)) и в параметре config передать путь к ini-файлу конфигурации (пример файла присутствует в каталоге Example - [config_example.ini](Example/config_example.ini))

#### Порядок использования
- Для добавления определенному пользователю БД 1С необходимо добавить указанного пользователя в соответствующую группу Active Directory
- Для удаления БД 1С необходимо удалить пользователя из соответствующей группы Active Directory
- Для применения политик необходима перезагрузка или выход пользователя из системы, т.к. logon-скрипт отрабатывает при авторизации пользователя

#### Особенности
- Не требует наличия установленного RSAT на рабочих станциях пользователей
- Не требует наличия Active Directory Web Services (работает в доменах Active Directory на базе Samba)
- Рабоает на базе Powershell v 2.0 и выше (тестировалось на версиях 2 и 5)
- Не удаляет БД, добавленные вручную
- Возможно использовать при эксплуатации 1С на терминальном сервере, т.к. БД добавляются для каждого доменного пользователя
- Проверяет наличие каталогов установки 1С и 1CEStart.cfg в каталоге %APPDATA%
- ini-файл конфигурации, csv-файл с данными и v8i-файлы конфигурации БД возможно хранить в сетевом каталоге, отличном от расположения скрипта

#### Пример файла csv
| Группа пользователей | Файл конфигурации БД | 
|-------------|----------|
| 1C_База_1 | \\\contoso.com\1C_DB_GPO\1C_База_1.v8i | 
| 1C_База_2 | \\\contoso.com\1C_DB_GPO\1C_База_2.v8i |
| 1C_База_... | \\\contoso.com\1C_DB_GPO\1C_База_.....v8i 
| 1C_База_N | \\\contoso.com\1C_DB_GPO\1C_База_N.v8i | 